# יומן שינויים (Changelog)

## גרסה 0.3.0

### תצוגת עמודים באותיות עבריות
- **בכל האפליקציה** מספרי עמודים מוצגים ונערכים באותיות עבריות (למשל: עמוד א', עמוד יא) ולא בספרות.
- **עריכת מיקום במצב חכם**: שדה העמוד מקבל ומציג אותיות (כולל מזוזה – מספר).
- **סיכום פרויקט**: רשת העמודים והדיאלוג "עמוד X" משתמשים ב-`formatHebrewNumber`.
- **תיאור סשן**: בכתיבה ידנית או במצב חכם – התיאור נשמר עם "עמוד יא" וכו'.
- פונקציות עזר ב-`hebrew_utils.dart`: `formatHebrewNumber`, `parseHebrewPageToNumber`.

### תאריכים עבריים / לועזיים
- **הגדרה חדשה בהגדרות**: "תאריכים לועזיים" – כשמופעל, כל התאריכים באפליקציה מוצגים בפורמט לועזי (יום.חודש.שנה).
- **מסכים מעודכנים**: מסך הבית, מסך הסיכומים (כולל בחירת תאריך), מסך הפרויקטים (תאריך יעד), מסך ההוצאות – כולם משתמשים ב-`formatDisplayDate` לפי ההגדרה.

### מסך הוצאות
- **מסך חדש "הוצאות"** בטאב התחתון (בין פרויקטים להגדרות).
- **כרטיס סה"כ הוצאות** בראש המסך (בהשראת מסך הכנסות/הוצאות).
- **רשימת הוצאות** עם: מוצר/קטגוריה, תאריך, סכום (₪). הוספה, עריכה ומחיקה.
- **קטגוריות מוצעות**: קורס סת"ם, הוצאות שוטפות, קולמוס מגילות/מזוזות/תש"י/תש"ר, משלוחים ונסיעות, תעודה, דיו/מי קלף/ציוד, תיקון סופרים, משקפיים, קלף והגהות (מגילות/מזוזות/תפילין), חדר סופרים – ובנוסף שדה טקסט חופשי.
- **מודל ואחסון**: `Expense` ב-`models.dart`; `StorageService.saveExpenses` / `loadExpenses`.

### הכנסות מול הוצאות (לפי חודש)
- **בסיכום החודשי** (כפתור "סיכום חודשי" במסך הסיכומים): נוספו שורות:
  - **הכנסות כתיבה (חודש)** – סך הרווח מהכתיבה באותו חודש.
  - **הוצאות (חודש)** – סך ההוצאות באותו חודש.
  - **נטו (לאחר הוצאות)** – הכנסות פחות הוצאות (ירוק אם חיובי, אדום אם שלילי).

### סנכרון הוצאות לדרייב
- **קובץ הגיבוי ב-Google Drive** (`sofer_vmone_backup.json`) כולל כעת גם את רשימת ההוצאות במלואה (כל רשומה: id, product, date, amount).
- מיזוג דו-כיווני של הוצאות כמו בפרויקטים והיסטוריה.

### חלון צף (Windows)
- **הפעלה רק בלחיצה**: החלון הצף נפתח רק בלחיצה על כפתור "חלון צף" בשורת הכותרת (אייקון + טקסט) – לא בהקטנת החלון.
- הכפתור מופיע רק ב-Windows, בצד ימין של ה-AppBar.

### עדכוני תוכנה
- **ללא בדיקה אוטומטית בכניסה**: האפליקציה לא בודקת עדכונים בפתיחה.
- **בדיקה רק בלחיצה**: עדכונים נבדקים רק כשלוחצים על "בדוק לעדכונים" במסך ההגדרות.

### שורת ניווט תחתונה (סיכומים, פרויקטים, הוצאות, הגדרות)
- **תיקון תצוגה**: הרקע והצבעים עודכנו כדי שהלחצנים והתוויות ייראו היטב (רקע סגול בהיר, נבחר בסגול כהה, לא נבחר באפור) – מניעת "שורה לבנה" עם טקסט לא נראה.

### אנימציית כתיבה – נוצה על קלף
- **במסך הבית ובמצב חכם**: כשהטיימר רץ מוצגת תיבה בסגנון קלף (רקע בז', מסגרת חומה) עם אייקון מכחול/נוצה והטקסט "כותב...".

### מחיקת פרויקטים – עדכון מיידי
- **עדכון רשימת הפרויקטים**: כשמסמנים פרויקט כ"נמחק" (מחיקה לוגית), המסך הראשי מסיר אותו מהרשימה מיד (כולל עדכון היסטוריה ושמירה).
- **חזרה למסך הבית**: אחרי אישור מחיקה נסגר מסך הפרויקטים והמשתמש חוזר למסך הבית עם רשימה מעודכנת.

### מסך הבית – התאמה למסך
- **מניעת גלישה**: גוף המסך עטוף ב-`SingleChildScrollView` + `ConstrainedBox` + `IntrinsicHeight` – התוכן נכנס למסך ואם אין מקום מתאפשר גלילה במקום overflow.
- צמצום רווחים (SizedBox) כדי שהמסך ייכנס טוב יותר.

### מסך אודות ותרומה
- **גרסה**: מוצגת גרסה 0.3.0.
- **קישור לאתר האפליקציה**: https://soferstam-app.github.io/sofer-vmone/
- **קישור לגיטהאב**: https://github.com/soferstam-app/sofer-vmone
- **בקשה לתרומה**: טקסט המסביר שעלויות הפיתוח והתחזוקה רבות, וקישור לתרומה: https://buymeacoffee.com/soferstam (עם אייקון קפה).
- **כפתור תרומה במסך הבית**: כפתור עם אייקון קפה וטולטיפ "תרום לפיתוח האפליקציה" – לחיצה פותחת את דף Buy Me a Coffee.
- מסך אודות זהה בהגדרות ובמסך הפרויקטים.

### גרסה וקבצים
- **גרסה**: `pubspec.yaml` – `version: 0.3.0+1`.
- **תיאור לאתר Buy Me a Coffee**: נוצר קובץ `docs/buy-me-a-coffee-description.md` עם טקסטים מוכנים (עברית ואנגלית) להדבקה בעמוד התרומה.

### תיקוני באגים וטכני
- **שימוש ב-context אחרי async**: תוקן במסך הפרויקטים (מחיקת פרויקט) – בדיקת `mounted` לפני `Navigator.pop(context)`.
- **הסרת קוד כפול**: הוסרה פונקציה לא בשימוש `_gematriaDecode` מ-`home_screen.dart` ( conversion באותיות כבר ב-`hebrew_utils.dart`).

---

## גרסה נוכחית (פיתוח)

### תוספות ושינויים במערכת (Infrastructure)
- **תמיכה ב-Java 8 Desugaring**: עודכן קובץ `android/app/build.gradle.kts` לאפשר `coreLibraryDesugaring` (נדרש עבור ספריית ההתראות).
- **חבילות חדשות**: נוספו `flutter_local_notifications` ו-`timezone` לקובץ `pubspec.yaml`.
- **תמיכה בסינון נטפרי**:
  - הוגדר `network_security_config.xml` לאישור תעודות משתמש.
  - עודכן `AndroidManifest.xml`.
  - נוסף מנגנון `HttpOverrides` ב-`main.dart` לטיפול בשגיאות SSL ספציפיות לנטפרי/גוגל.

### ניהול נתונים וסנכרון
- **מודלים (`models.dart`)**:
  - נוסף שדה `isDeleted` לתמיכה במחיקה לוגית (Soft Delete).
  - נוסף שדה `lastUpdated` לניהול גרסאות וסנכרון.
- **שירות סנכרון (`sync_service.dart`)**:
  - פותח שירות חדש לסנכרון דו-כיווני מול Google Drive.
  - מנגנון מיזוג (Merge) חכם לנתונים.
  - ניקוי אוטומטי של פריטים שנמחקו לפני יותר מ-30 יום.

### פיצ'רים למשתמש
- **התראות יומיות**:
  - מערכת תזכורות יומית (`NotificationService`).
  - מסך הגדרות לשליטה על שעת ההתראה והפעלה/כיבוי.
  - ביטול אוטומטי של ההתראה במידה והמשתמש עמד ביעד היומי.
- **סל מחזור**:
  - מסך חדש לשחזור פרויקטים שנמחקו.
  - אפשרות למחיקה סופית.
- **שיפורי טיימר ומסך הבית**:
  - אפשרות ל"הפסקת קפה" (השהייה).
  - כפתור "סיימתי שורה" (Lap).
  - התאמת גודל פונט הטיימר למסכים צרים.
  - תיקון חישוב שעות בהזנה ידנית (כולל גלישה ליום הבא).
- **גרפים וסטטיסטיקה**:
  - נוסף גרף עמודות בסיכום החודשי להצגת התקדמות יומית.

---

## שינויים מאז שחרור גרסה 0.2.0 (תג APP)

_עדכון: שינויים שבוצעו לאחר [שחרור GitHub](https://github.com/soferstam-app/sofer-vmone/releases/tag/APP)._

### תיקוני באגים
- **שימוש ב-BuildContext אחרי await**: תוקן שימוש ב-`context` אחרי פעולה אסינכרונית ב-`home_screen.dart` (כפתור "הוסף") וב-`settings_screen.dart` (דיאלוג מחיקת פרויקט) – נוספה בדיקת `mounted` לפני שימוש ב-context.
- **סנכרון תאריכים סביב חצות**: תאריך המסך הראשי והתאריך ברירת המחדל בהזנה ידנית מסונכרנים כעת לפי "שעת מעבר יום" (ראו בהגדרות).

### מסכים ומבנה
- **מסך פרויקטים נפרד**: ניהול הפרויקטים הועבר מהגדרות למסך נפרד "פרויקטים". בתפריט התחתון: סיכומים | פרויקטים | הגדרות.
- **מסך הגדרות**: מכיל כעת רק התראות, זרימת עבודה חכמה, שעת מעבר יום, שישי/מוצאי שבת כחצי יום, כניסה/סנכרון גוגל, אודות ועדכונים (מחשב).

### סנכרון
- **סנכרון אוטומטי**: סנכרון ל-Google Drive מתבצע בפתיחת האפליקציה ובכל שמירה (פרויקטים, היסטוריה, כולל עדכונים ממסך הסיכומים).

### פרויקטים ומודל
- **אימייל לקוח**: שדה אופציונלי בפרויקט לשליחת עדכון ללקוח.
- **תאריך יעד לסיום**: בפרויקט מסוג ספר תורה ניתן להגדיר תאריך יעד; האפליקציה מחשבת "שורות ליום שנותר" כדי לעמוד ביעד.
- **כפתור "שלח עדכון ללקוח"**: במסך סיכום פרויקט – פותח את תוכנת המייל (Gmail/Outlook וכו') עם כתובת הלקוח וטקסט מוכן.

### מחשבון ימי עבודה
- **קובץ חדש `work_days_calculator.dart`**: חישוב ימי עבודה בהתחשב בשבת וחגים (ספריית kosher_dart).
- **שורה "מתי אני אמור לסיים"**: במסך סיכום פרויקט, מתחת ל"ממוצע" – תאריך משוער לסיום לפי הספק יומי.
- **הגדרה "ימי שישי ומוצאי שבת כחצי יום"**: בהגדרות – כשמופעל, בחישוב ימי העבודה שישי ומוצאי שבת נספרים כחצי יום כל אחד.

### שעת מעבר יום
- **הגדרה "שעת מעבר יום" (0–23)**: לטובת סופרים שמסיימים מאוחר – מתי מתחיל "היום" (למשל 02:00). משפיע על התאריך העברי במסך הראשי ועל ברירת המחדל בהזנה ידנית.

### מצב חכם
- **עריכת מיקום**: כפתור "ערוך מיקום" – מעבר ישיר לעמוד/מזוזה ושורה רצויים (למשל מעמוד א' שורה 27 לעמוד ח' שורה 7).

### טיימר וחוויית שימוש
- **אנימציית קולמוס**: כשהטיימר רץ (ללא הפסקה) מוצגת אנימציה קטנה "כותב..." עם אייקון קולמוס (במסך הרגיל ובמצב חכם).

### עריכת רשומות (מסך סיכומים)
- **מחיקה מרובה**: תיבת סימון לכל רשומה וכפתור "מחק נבחרים" למחיקת כמה רשומות בפעם אחת בלי לצאת ולחזור.
- **עריכת רשומה**: כפתור עריכה (עפרון) – דיאלוג לעריכת שעת התחלה/סיום, שורות התחלה/סיום וכמות (תיקון טעויות בהזנה).

### טכני
- **מודל `Project`**: שדות חדשים `clientEmail`, `targetCompletionDate`; תמיכה ב-`toJson`/`fromJson` ו-`copyWith`.
- **מודל `WorkSession`**: נוסף `copyWith` לעריכת רשומות.
- **אחסון**: מפתחות חדשים ל-`day_rollover_hour` ו-`friday_motzei_half_day` ב-`StorageService`.